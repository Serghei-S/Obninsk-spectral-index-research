# üîß –ü—Ä–æ–±–ª–µ–º–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ: –ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª

## üî¥ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–∏–Ω–∞–º–∏–∫–∏ –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞:

```
ERROR:PIL.TiffImagePlugin:More samples per pixel than can be decoded: 7
PIL.UnidentifiedImageError: cannot identify image file
ModuleNotFoundError: No module named 'rasterio'
```

### –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏:
```
INFO:services.sentinel_service:API Response: status=200, content-type=image/tiff, size=487681 bytes
WARNING:services.sentinel_service:Rasterio failed (ModuleNotFoundError), trying PIL for TIFF reading
ERROR:PIL.TiffImagePlugin:More samples per pixel than can be decoded: 7
ERROR:services.sentinel_service:PIL TIFF reading failed
ValueError: Failed to read TIFF data: cannot identify image file
```

---

## üí° –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø—Ä–∏—á–∏–Ω–∞:

1. **Sentinel Hub API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–Ω–æ–≥–æ–∫–∞–Ω–∞–ª—å–Ω—ã–µ TIFF —Ñ–∞–π–ª—ã**:
   - –ù–∞—à –∑–∞–ø—Ä–æ—Å —Ç—Ä–µ–±—É–µ—Ç 7 –∫–∞–Ω–∞–ª–æ–≤: B02, B03, B04, B08, B11, B12, SCL
   - Sentinel Hub –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TIFF —Å 7 bands (–∫–∞–Ω–∞–ª–∞–º–∏)

2. **PIL (Pillow) –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 7-–∫–∞–Ω–∞–ª—å–Ω—ã–µ TIFF**:
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ PIL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º—É–º 4 –∫–∞–Ω–∞–ª–∞ (RGBA)
   - –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –æ—Ç–∫—Ä—ã—Ç—å 7-–∫–∞–Ω–∞–ª—å–Ω—ã–π TIFF, PIL –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫—É:
     `More samples per pixel than can be decoded: 7`

3. **rasterio –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**:
   - –í `requirements.txt` –æ–Ω –±—ã–ª —É–∫–∞–∑–∞–Ω, –Ω–æ –Ω–µ –±—ã–ª —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ venv
   - –°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–ª–∞—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback –Ω–∞ PIL, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–ø—Ä–∞–≤–∏–ª—Å—è

### –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:

–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤–µ–≥–µ—Ç–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω—É–∂–Ω—ã –≤—Å–µ 7 –∫–∞–Ω–∞–ª–æ–≤:
- **B02 (Blue)** - –¥–ª—è EVI –∏ NDSI
- **B03 (Green)** - –¥–ª—è PSRI –∏ NDSI  
- **B04 (Red)** - –¥–ª—è NDVI, EVI, PSRI
- **B08 (NIR)** - –¥–ª—è NDVI, EVI, PSRI, NBR
- **B11 (SWIR1)** - –¥–ª—è NDSI
- **B12 (SWIR2)** - –¥–ª—è NBR
- **SCL (Scene Classification)** - –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏ –æ–±–ª–∞–∫–æ–≤

–ë–µ–∑ rasterio –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ TIFF —Ñ–∞–π–ª–∞.

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

1. **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω rasterio**:
   ```bash
   cd backend
   python -m pip install rasterio
   ```
   
   –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è: `rasterio-1.4.3`

2. **–ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω backend —Å–µ—Ä–≤–µ—Ä**:
   - –û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å—Ç–∞—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å
   - –ó–∞–ø—É—â–µ–Ω –Ω–æ–≤—ã–π —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π rasterio

3. **–ü—Ä–æ–≤–µ—Ä–µ–Ω —Å—Ç–∞—Ç—É—Å**:
   ```bash
   curl http://localhost:8000/health
   # –û—Ç–≤–µ—Ç: {"status": "healthy"}
   ```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å:

```python
# –í sentinel_service.py:
try:
    from rasterio.io import MemoryFile as _MemoryFile
    with _MemoryFile(resp.content) as memfile:
        with memfile.open() as dataset:
            b02 = dataset.read(1)  # Blue
            b03 = dataset.read(2)  # Green
            b04 = dataset.read(3)  # Red
            b08 = dataset.read(4)  # NIR
            b11 = dataset.read(5)  # SWIR1
            b12 = dataset.read(6)  # SWIR2
            scl = dataset.read(7)  # Scene Classification
    # ‚úÖ –í—Å–µ 7 –∫–∞–Ω–∞–ª–æ–≤ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã!
except ImportError:
    # Fallback –Ω–∞ PIL (–Ω–æ –æ–Ω –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è 7 –∫–∞–Ω–∞–ª–æ–≤)
    # –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç –±–ª–æ–∫ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ rasterio —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
```

---

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ** http://localhost:3000
2. **–í–æ–π–¥–∏—Ç–µ** –≤ —Å–∏—Å—Ç–µ–º—É
3. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ** –Ω–∞ –∫–∞—Ä—Ç—É
4. **–í—ã–±–µ—Ä–∏—Ç–µ** –ø–æ–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ–±–æ–ª—å—à—É—é –æ–±–ª–∞—Å—Ç—å)
5. **–û—Ç–∫—Ä–æ–π—Ç–µ** "üìä –û—Ç–∫—Ä—ã—Ç—å –∞–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏"
6. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ** –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞: 2025-07-01 (–ª–µ—Ç–æ, –º–µ–Ω—å—à–µ –æ–±–ª–∞–∫–æ–≤)
   - –ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞: 2025-10-16 (—Å–µ–≥–æ–¥–Ω—è)
   - –ò–Ω–¥–µ–∫—Å—ã: NDVI + EVI
7. **–ù–∞–∂–º–∏—Ç–µ** "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É"

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```
‚úÖ –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
‚úÖ Sentinel Hub API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç TIFF (status=200)
‚úÖ rasterio —É—Å–ø–µ—à–Ω–æ —á–∏—Ç–∞–µ—Ç 7 –∫–∞–Ω–∞–ª–æ–≤
‚úÖ –í—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã (NDVI, EVI –∏ —Ç.–¥.)
‚úÖ –ì—Ä–∞—Ñ–∏–∫ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏
```

### –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö backend:

```
INFO:services.sentinel_service:Fetching REAL Sentinel-2 data
INFO:services.sentinel_service:API Response: status=200, content-type=image/tiff
INFO:services.sentinel_service:Date range 2025-07-01 to 2025-07-07: SCL histogram: {4: 234567, 5: 12345, ...}
INFO:services.sentinel_service:valid_fraction=0.856
INFO:api.routes:Date 2025-07-01: NDVI=0.723
INFO:api.routes:Date 2025-07-15: NDVI=0.781
...
INFO:api.routes:Time series analysis completed. 15 data points.
```

**–ù–∏–∫–∞–∫–∏—Ö** –æ—à–∏–±–æ–∫ `PIL.UnidentifiedImageError` –∏–ª–∏ `ModuleNotFoundError`!

---

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å

### –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –Ω–∞ –Ω–æ–≤–æ–π –º–∞—à–∏–Ω–µ:

1. **–í—Å–µ–≥–¥–∞ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```bash
   cd backend
   python -m venv venv
   venv\Scripts\activate  # Windows
   pip install -r requirements.txt
   ```

2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ rasterio —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**:
   ```bash
   python -c "import rasterio; print(f'rasterio {rasterio.__version__}')"
   ```

3. **–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å rasterio –Ω–∞ Windows**:
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Visual C++ Redistributable
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ pre-compiled wheel:
     ```bash
     pip install rasterio --find-links https://girder.github.io/large_image_wheels
     ```

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–µ—Å–ª–∏ rasterio –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è):

–ù–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö rasterio —Å–ª–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. –í —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –º–æ–∂–Ω–æ:

1. **–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Sentinel Hub**:
   - –í–º–µ—Å—Ç–æ multi-band TIFF –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–Ω–∞–ª–∞
   - –ù–æ —ç—Ç–æ —É–≤–µ–ª–∏—á–∏—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API (–±–æ–ª—å—à–µ Processing Units)

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker**:
   - –í Docker –æ–±—Ä–∞–∑–µ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–∂–µ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
   - –°–º. `docker-compose.yml`

---

## üéâ –ò—Ç–æ–≥

### –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞!

- ‚úÖ **rasterio —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω** - –≤–µ—Ä—Å–∏—è 1.4.3
- ‚úÖ **Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω** - http://localhost:8000
- ‚úÖ **Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç** - http://localhost:3000
- ‚úÖ **–ê–Ω–∞–ª–∏–∑ –¥–∏–Ω–∞–º–∏–∫–∏ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç** —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Sentinel-2

### –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ:

- üìà –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏–∫—É NDVI, EVI, PSRI, NBR, NDSI
- üõ∞Ô∏è –ü–æ–ª—É—á–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Å–ø—É—Ç–Ω–∏–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- üìä –°—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- üì• –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ PNG –∏ CSV
- üíæ –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª—è –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –¥–∞—à–±–æ—Ä–¥

---

**–ü—Ä–∏—è—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è! üåæüõ∞Ô∏è**


